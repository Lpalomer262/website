---
title: Code For Denver
author: Leonardo D. Palomera
date: '1991-02-15'
categories:
  - R
tags:
  - Academic
  - R Markdown
  - Visualization
output: html_document
subtitle: Code For Denver
summary: Educational Visulzation
---



<pre class="r"><code># STUDENT NAME KEY --------------------------------------------------------
#&#39; STUDENT DATABASE
student_link &lt;- &quot;http://gsndev.com/gsndb/my/student/&quot;
student_key &lt;-  jsonlite::fromJSON(txt = student_link, flatten = TRUE) %&gt;% 
  as_tibble() %&gt;%
  rename(student_name = studentName)

# STUDENT INFORMATION -----------------------------------------------------
json_links&lt;- paste0(&quot;http://gsndev.com/gsndb/my/student/&quot;, seq(1:2), &quot;/&quot;)


load_info &lt;- function(link){
  json_data &lt;- 
    jsonlite::fromJSON(txt = link, flatten = TRUE) %&gt;% 
    as_tibble() 
  
  #&#39; EXTRACT COMMON VARIABLES
  student_info &lt;- json_data %&gt;% select(studentId:reasonInProgram) %&gt;% 
    left_join(student_key %&gt;% select(studentId, student_name),
              by = &quot;studentId&quot;)
  
}


load_grades &lt;- function(link){
  json_data &lt;- 
    jsonlite::fromJSON(txt = link, flatten = TRUE) %&gt;% 
    as_tibble() 
  
  #&#39; GRADES
  grade &lt;- json_data$gradeSet %&gt;% 
    data.frame() %&gt;% as_tibble() %&gt;%
    mutate(grade = as.numeric(grade)) %&gt;%
    #&#39; ADD SUMMER AND WINTER 
    mutate(term = ifelse(str_detect(courseTerm, &quot;FLL&quot;), &quot;Fall&quot;, &quot;Spring&quot;),
           term = factor(term, levels = c(&quot;Fall&quot;, &quot;Spring&quot;)),
           courseTermId = factor(courseTermId),
           year = as.numeric(str_extract(courseTerm, &quot;[0-9]{4}&quot;))) %&gt;% 
    left_join(student_key %&gt;% select(studentId, student_name),
              by = &quot;studentId&quot;)
  
}


load_notes&lt;- function(link){
  json_data &lt;- 
    jsonlite::fromJSON(txt = link, flatten = TRUE) %&gt;% 
    as_tibble() 
  
  #&#39; TEACHERS NOTES
  notes &lt;- json_data$noteSet %&gt;% 
    
    data.frame() %&gt;% as_tibble() %&gt;%
    mutate(createdUpdated = ymd_hms(createdUpdated)) %&gt;% 
    left_join(student_key %&gt;% select(studentId, student_name),
              by = &quot;studentId&quot;)
} 



load_attendence&lt;- function(link){
  json_data &lt;- 
    jsonlite::fromJSON(txt = link, flatten = TRUE) %&gt;% 
    as_tibble() 
  
  #&#39; ATTENDENCE
  attendance &lt;- json_data$attendanceSet %&gt;% data.frame() %&gt;% as_tibble() %&gt;%
    mutate(attendanceEntryDate = ymd_hms(attendanceEntryDate)) %&gt;% 
    mutate_at(
      vars(c(&quot;totalUnexabs&quot;, &quot;totalExabs&quot;, 
             &quot;totalTardies&quot;, &quot;avgDailyAttendance&quot;)),
      as.numeric) %&gt;% 
    left_join(student_key %&gt;% select(studentId, student_name),
              by = &quot;studentId&quot;) 
} 

#&#39; LOAD ALL INFORMATION
attendence &lt;- map_df(json_links, load_attendence)
student_info &lt;- map_df(json_links, load_info)
#&#39; notes &lt;- map_df(json_links[2], load_notes)


# GRADES ------------------------------------------------------------------

grades &lt;- map_df(json_links, load_grades) 

grades_long &lt;- grades %&gt;%
  #filter(studentId == 1) %&gt;%
  group_by(studentId, student_name, year, term, 
           courseTermId, #&#39; REPLACE WITH
           courseName, finalGradeForTerm) %&gt;%
  summarise(
    max_grade = max(grade, na.rm = TRUE)
  ) %&gt;% 
  ungroup() %&gt;%
  arrange(year, term) %&gt;%
  group_by(courseName) %&gt;%
  mutate(avg_grade = mean(max_grade, na.rm = TRUE)) %&gt;%
  ungroup()



# VARIABLE ----------------------------------------------------------------
student_ids &lt;- distinct(student_key, student_name) %&gt;% pull()
academic_term &lt;- c(&quot;Fall&quot;, &quot;Spring&quot;, &quot;Winter&quot;, &quot;Summer&quot;)
academic_year &lt;- c(2017, 2018)

# Define UI for application that draws a histogram
ui &lt;- fluidPage(
   
   # Application title
   titlePanel(&quot;Denver Unified School District&quot;),
   
   # Sidebar with a slider input for number of bins 
   sidebarLayout(
      sidebarPanel(
        #&#39;VARIABLE INPUT - STUDENT NAME
         selectInput(inputId = &#39;student_names&#39;,
                     label = &#39;Student Name:&#39;, 
                     choices = student_ids, 
                     selected = NULL,
                     #&#39; WOULDN&#39;T MAKE SENSE TO HAVE MULTIPLE
                     multiple = FALSE
                     ),
         #&#39; VARIABLE INPUT - ACADEMIC YEAR
         selectInput(inputId = &#39;academic_year&#39;, 
                     label = &#39;Academic Year&#39;, 
                     choices = academic_year,
                     selected = &quot;2018&quot;,
                     multiple = FALSE),
         #&#39; VARIABLE INPUT - ACADEMIC TERM
         selectInput(inputId = &#39;academic_term&#39;,
                     label = &#39;Academic Term&#39;, 
                     choices = academic_term,
                     selected = &quot;Spring&quot;,
                     multiple = FALSE)
         
         
      ),
      
      # Show a plot of the generated distribution
      mainPanel(
         plotOutput(&quot;distPlot&quot;),
         tableOutput(&quot;table_grades&quot;),
         plotOutput(&quot;plot_attendence&quot;)
      )
   )
)

# Define server logic required to draw a histogram
server &lt;- function(input, output) {
   
   output$distPlot &lt;- renderPlot({
     #&#39; VISUALIZE ALL GRADES ACCROSS VARIOUS SEMESTERS
     grades_long %&gt;% 
       filter(student_name == input$student_names) %&gt;%
       ggplot(aes(x = courseTermId, y = max_grade)) +
       stat_mean_line(color = &quot;red&quot;, aes(courseTermId, avg_grade)) +
       geom_point() + 
       facet_wrap(~courseName) +
       pretty_theme +
       labs(
         title = &quot;Average Grades by Subject&quot;, 
         subtitle = &quot;[[Sub-Title]]&quot;,
         x = &quot;Course&quot;, 
         y = &quot;Average&quot;) -&gt; grades_graph
     
     #&#39; EXPORT VISULIZATION
     print(grades_graph)
    
   })
   
   
   output$table_grades &lt;- renderTable({
     
     last_grades &lt;- grades_long %&gt;%
       filter(student_name == input$student_names) %&gt;%
       #&#39; THIS SHOULD BE REPLACED BY THE LASTEST DATA
       dplyr::filter(year == input$academic_year) %&gt;%
       dplyr::filter(term == input$academic_term)
     
     #&#39; TABLE BASES ON LAST GRADES
     last_grades &lt;- last_grades %&gt;%
       select(-avg_grade) %&gt;%
       spread(courseName, max_grade) %&gt;%
       select(-studentId, -year, -term, -courseTermId,
              #&#39; YOU MIGHT WANT TO KEEP THIS FLAG
              -finalGradeForTerm, -student_name)
     
     last_grades 
     
   })
   
   
   output$plot_attendence &lt;- renderPlot({
     
     
     attendence %&gt;%
       filter(student_name == input$student_names) %&gt;%
       select(student_name, attendanceEntryDate, totalUnexabs:totalTardies) %&gt;%
       gather(-student_name, -attendanceEntryDate, key = &quot;type&quot;, value = &quot;days&quot;) %&gt;%
       mutate(type_pretty = case_when(
         type == &quot;totalExabs&quot;   ~ &quot;Excused Absents&quot;,
         type == &quot;totalTardies&quot; ~ &quot;Tardies&quot;,
         type == &quot;totalUnexabs&quot; ~ &quot;Unexcused Absents&quot;,
         TRUE                   ~ NA_character_
       )) %&gt;%
       ggplot(aes(x = type_pretty, y = days, 
                 # color = type_pretty, 
                  fill = type_pretty)) +
       geom_bar(stat = &quot;identity&quot;) + 
       facet_wrap(~ attendanceEntryDate) + 
       pretty_theme_attendence +
       labs(
         title = &quot;Quarterly Attendence&quot;, 
         subtitle = &quot;[[Sub-Title]]&quot;,
         x = &quot;Months&quot;, 
         y = &quot;Total&quot;) + 
       labs(fill = &quot;Attendence Type&quot;) -&gt; attendence_graph
     
     print(attendence_graph)
     
   })
   
}

# Run the application 
shinyApp(ui = ui, server = server)</code></pre>
<pre><code>## PhantomJS not found. You can install it with webshot::install_phantomjs(). If it is installed, please make sure the phantomjs executable can be found via the PATH variable.</code></pre>
<div style="width: 100% ; height: 400px ; text-align: center; box-sizing: border-box; -moz-box-sizing: border-box; -webkit-box-sizing: border-box;" class="muted well">Shiny applications not supported in static R Markdown documents</div>
