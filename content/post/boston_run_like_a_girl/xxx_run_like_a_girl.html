---
title: Run Like a Girl
author: Leonardo D. Palomera
date: '2019-04-15'
categories:
  - Boston Marathon
  - R
  - Running
tags:
  - Academic
  - R Markdown
  - Visualization
output: html_document
subtitle: Read about the those Running Boston
summary: Looking for an ideal Boston pacing stratagy, look no more
---



<div id="tldr" class="section level2">
<h2>TLDR;</h2>
<ul>
<li><p>An analysis of more than 75,000 Boston Marathon race-records during the period 2014–2016;</p></li>
<li><p>How do runners pace the Boston Marathon? Where are the fastest and slowest sections of the race?</p></li>
<li><p>How does the pacing of elites compare to recreational runners and those running a personal-best?</p></li>
<li><p>Putting what we learn into practice, we create optimal pacing charts for recreational runners that are tailored for Boston.</p></li>
</ul>
</div>
<div id="introduction" class="section level2">
<h2>Introduction</h2>
<p>In this post we present a similar analysis for the Boston course. This time it is based on more than 70,000 individual race-records for Boston runners, from the period 2014–2016, excluding 2013. These race-records include 5km (approx. 3.1 miles) split-times and therefore allow us to analyse pacing at regular intervals.</p>
<p>To start, the chart below shows the average pacing (minutes per mile) for non-elite (recreational/regular) runners. The ‘ribbon plot’ shows the average pace per race segment (the marked centre line) and the average pacing for men and women. The chart also shows the course profile. As an aside the pacing ribbon has been left-shifted to the halfway point of each race segment for better visual alignment. For example, the first marker, which is plotted at the 2.5km (1.5m) mark actually reflects the pacing for the segment from the startline to the 5km/3.1m point.</p>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>boston_mean_paces &lt;- 
  boston_long_5k_42.2k %&gt;% group_by(km_pretty) %&gt;%
  summarise(
    average = mean(mi_pace, na.rm = TRUE),
    male =
      mean(if_else(m_f == &quot;Male&quot;, mi_pace, NA_real_), na.rm = TRUE),
    female =
      mean(if_else(m_f == &quot;Female&quot;, mi_pace, NA_real_), na.rm = TRUE)
  ) %&gt;% 
  ungroup() %&gt;%
  gather(&quot;type&quot;, &quot;pace&quot;, -km_pretty)</code></pre>
<p>On average we can see that the typical Boston marathoner starts at a pace of about 8 minutes and 15 seconds per mile but gradually slows to finish up running at around 10 minutes per mile by the end of the race; most do manage a final ‘sprint’ of sorts to the finish-line. The steep starting descent clearly doesn’t help when it comes to runners controlling their opening pace and fast-starts are known to be problematic later in the race. It’s a hilly course in general but the real hills start around the 15 mile mark and this shows the pacing above, with pacing slowing consistently througout the Newton Hills and beyond. Clearly, the average Boston runner starts outs fast and then spends the rest of their race paying for it as they gradually slow, completing a positive split with the second half of the race approximately 14% slower than then first.</p>
<pre class="r"><code>boston_long_5k_42.2k %&gt;% group_by(km_pretty) %&gt;% 
  summarise(mi_pace_mean = mean(mi_pace, na.rm = TRUE)) %&gt;%
  ggplot(aes(km_pretty, mi_pace_mean, group = 1)) +
  geom_line(linetype = &quot;dashed&quot;) +
  geom_point() </code></pre>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<p>A word of caution here, pacing above includes people who hit the dreaded wall in the second half of the race. This means that some of the slow down shown will be exagerated, at least somewhat, by these poor souls.</p>
</div>
<div id="perfect-pacing-for-boston" class="section level2">
<h2>Perfect pacing for Boston</h2>
<p>We have found a fairly consistent pattern when it comes to how recreational runners pace Boston. Relative pace varies predictably across a broad field of runners, as it is influenced by growing fatigue, the significant undulations of the course, the noise of the crowd, the excitement of the start etc. It is a consistent pattern but, presumably, it is not a very optimal one. Certainly one lesson seems to be that, on average, runners start fast, probably too fast, The pay-back is a considerable slowing of pace as the race continues. The pacing range for recreational runners is particularly wide, from starts that are about 8–9% faster than average race-pace, to finishes that are 10–12% slower. This makes for an overall pacing range of 20% or more.</p>
<pre class="r"><code>ggplot(boston_mean_paces, 
       aes(km_pretty, pace, group = type, color = type)) + 
  geom_line()</code></pre>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>pace_km &lt;- boston %&gt;% 
  mutate(pace_km = km_42.2 / 42.2195) %&gt;%
  select(boston_key, km_42.2, pace_km)</code></pre>
<p>This begs the question: what is the optimal pacing profile for Boston? The conventional wisdom is that more even pacing is the way to go and so there is considerable room for improvement for the average runner in this regard. Easier said than done! And surely perfectly even pacing on a hilly course like Boston is not optimal anyway? To arrive an an optimal pacing profile we might start by isolating the pacing profiles of the very best runners, and to do this we will consider two groups of strong runners: those running a personal best (PB), regardless of finish-time, and elites.</p>
<pre class="r"><code>boston_paces_pct &lt;- boston_long_5k_42.2k %&gt;% 
  left_join(
    pace_km, by = &quot;boston_key&quot;
  ) %&gt;%
  #&#39; CALCULATE RELATIVE PERCENTAGE PER KM
  mutate(
    pace_5k_mean = 5 * pace_km,
    relative_pacing = ((split_sec -  pace_5k_mean) / pace_5k_mean) * 100,
    relative_pacing = 
      if_else(km == &quot;km_42.2&quot;,
              ((split_sec - (2.195 * pace_km)) /
                (2.195 * pace_km)) * 100,
              relative_pacing))

boston_percent_overall &lt;- boston_paces_pct %&gt;%
  # CALCULATE AVERAGES BY GROUP: OVERALL, MALE, FEMALE
  group_by(km_pretty) %&gt;%
  summarise(
    average = mean(relative_pacing, na.rm = TRUE),
    male =
      mean(if_else(m_f == &quot;Male&quot;, relative_pacing, NA_real_), na.rm = TRUE),
    female =
      mean(if_else(m_f == &quot;Female&quot;, relative_pacing, NA_real_), na.rm = TRUE)
  ) %&gt;% 
  ungroup() %&gt;%
  gather(&quot;type&quot;, &quot;percent_overall&quot;, - km_pretty)</code></pre>
<pre class="r"><code>ggplot(boston_percent_overall, 
       aes(km_pretty, percent_overall, group = type, color = type)) + 
  geom_line()</code></pre>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<div id="pacing-for-a-personal-best" class="section level5">
<h5>Pacing for a Personal-Best</h5>
<p>Our dataset includes runners who have run more than one marathon and for these runners we can identify PB times from their set of times; essentially we treat their fastest time among their set of races as their PB. For the purpose of this study we will consider those runners who have run at least 3 Boston marathons. There are almost 10,000 such runners in our dataset and they have run an average of just over 4 Boston Marathons each. For each of these runners we can identify their ‘personal-best’ as their fastest Boston time. Of course this might not be their true personal best, since it depends entirely on the window of data that we have access too, but it at least counts as a good time for these runners at Boston.</p>
<pre class="r"><code>boston_percent_returners &lt;- boston_paces_pct %&gt;%
  inner_join(boston_returners, by = &quot;boston_key&quot;) %&gt;%
  # CALCULATE AVERAGES BY GROUP: OVERALL, MALE, FEMALE
  group_by(km_pretty) %&gt;%
  summarise(
    average = mean(relative_pacing, na.rm = TRUE),
    male =
      mean(if_else(m_f == &quot;Male&quot;, relative_pacing, NA_real_), na.rm = TRUE),
    female =
      mean(if_else(m_f == &quot;Female&quot;, relative_pacing, NA_real_), na.rm = TRUE)
  ) %&gt;%
  ungroup() %&gt;%
  gather(&quot;type&quot;, &quot;percent_returner&quot;, -km_pretty)</code></pre>
<pre class="r"><code>ggplot(boston_percent_returners, 
       aes(km_pretty, percent_returner, group = type, color = type)) + 
  geom_line()</code></pre>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-9-1.png" width="672" /></p>
<p>Next, we can compute the pacing profiles for these PB runners as before to the get the chart below. On the face of it, we see a similar shape to the pacing profile of the regular runners we looked at earlier: PBs start faster and finish slower than their average race pace, just like regular runners. However, the key difference is that, compared to regular runners, those running a PB start a little slower and finish a little faster. For example, the average PB runner starts only 4% faster than their average race pace, holds this pace for the first 9 miles or so and then starts to skow. But they don’t slow as much as regular runners. Yes, we can still see the effect of the Newton Hills but they slow to only about 5% slower than their average race-pace. In other words, the pace variation for runners completing a PB tends to fall within a range of just 9% (from -4% at the start to 5% at the end) compared to more than 20% from regular runners.</p>
<pre class="r"><code>boston_percent_elites &lt;- boston_paces_pct %&gt;%
  filter(elites == &quot;Elite&quot;) %&gt;%
  # CALCULATE AVERAGES BY GROUP: OVERALL, MALE, FEMALE
  group_by(km_pretty) %&gt;%
  summarise(
    average = mean(relative_pacing, na.rm = TRUE),
    male =
      mean(if_else(m_f == &quot;Male&quot;, relative_pacing, NA_real_), na.rm = TRUE),
    female =
      mean(if_else(m_f == &quot;Female&quot;, relative_pacing, NA_real_), na.rm = TRUE)
  ) %&gt;% 
  ungroup() %&gt;%
  gather(&quot;type&quot;, &quot;percent_elites&quot;, - km_pretty)</code></pre>
</div>
</div>
<div id="conclusion" class="section level2">
<h2>Conclusion</h2>
<p>Of course the notion that elites pace perfectly in every race is probably too strong an assumption to make. In any given race there will be many factors that influence their pacing: course conditions, the competition, how they feel on the day etc. However, on average, when pacing is analysed over many runners and a number of years, a strong pattern emerges and it is this pattern that might be important when it comes to informing the pacing of other runners.</p>
<pre class="r"><code>ggplot(boston_percent_elites, aes(km_pretty, percent_elites, group = type, color = type)) +
  geom_line()</code></pre>
<p><img src="/post/boston_run_like_a_girl/xxx_run_like_a_girl_files/figure-html/unnamed-chunk-11-1.png" width="672" /></p>
<p>The hope is that the pacing tables produced from this profile may allow recreational or first time runners at Boston to replicate this ‘perfect’ pacing profile in their own races and for their running ability and target times. Doing so may help to produce better performance on the day.</p>
<pre class="r"><code>pacing_boston &lt;- function(projected_time = 180){
  
  #&#39; DOUBLE CHECK THAT ALL VALUES IN THE FUNCTION ARE NUMBER
  stopifnot(is.numeric(projected_time))
  
  pace_chart &lt;- projected_time %&gt;% 
    as_tibble() %&gt;%
    rename(goal_pace_min = value) %&gt;% 
    mutate(goal_pace_sec = period_to_seconds(minutes(goal_pace_min))) %&gt;%
    mutate(split_5k_even  = goal_pace_sec * (5/42.2),
           split_10k_even = goal_pace_sec * (10/42.2),
           split_15k_even = goal_pace_sec * (15/42.2),
           split_20k_even = goal_pace_sec * (20/42.2),
           split_25k_even = goal_pace_sec * (25/42.2),
           split_30k_even = goal_pace_sec * (30/42.2),
           split_35k_even = goal_pace_sec * (35/42.2),
           split_40k_even = goal_pace_sec * (40/42.2)) %&gt;%
    gather(-goal_pace_min,-goal_pace_sec, key = &quot;split_even&quot;, value = &quot;pace_seconds&quot;) %&gt;%
    mutate(km_pretty = 
             paste(&quot;km&quot;, str_replace_all(split_even, &quot;split\\_|k\\_even&quot;, &quot;&quot;), sep = &quot; &quot;)) %&gt;%
    mutate(km_pretty =  factor(km_pretty, 
                               levels = c(&quot;km 5&quot;, &quot;km 10&quot;, &quot;km 15&quot;, &quot;km 20&quot;,
                                          &quot;km 25&quot;, &quot;km 30&quot;, &quot;km 35&quot;, &quot;km 40&quot;, 
                                          &quot;km 42.2&quot;)))
  
  
  pace_chart_est &lt;- pace_chart %&gt;%
    left_join(
      percent_aggregate %&gt;% 
        filter(type == &quot;female&quot;) %&gt;% 
        #&#39; REMOVE THE OVERALL RUNNER SINCE WE DONT CARE FOR PEOPLE TO FOLLOW THEIR PACE
        filter(!(runner_class %in% c(&quot;Overall&quot;, &quot;Returner&quot;))) %&gt;%
        #&#39; FOR NOW, LETS ONLY HAVE A SINGLE OPTION
        select(-type) ,
      by = &quot;km_pretty&quot;) %&gt;%
    #&#39; CALCULATE ESTIMATED SPLITS BASED ON [[AVERAGE ELITES]]
    mutate(pace_estimates = pace_seconds + (pace_seconds * (percent_change / 100)))
  
  #&#39; CALCULATE 5K SPLITS (POTENTAL RESEARCH PROJECT)
  pace_chart_goal &lt;- pace_chart_est %&gt;%
    mutate(split_goal = str_replace_all(split_even, &quot;even&quot;, &quot;mark&quot;)) %&gt;%
    select(split_goal, runner_class, goal_pace_min, goal_pace_sec, pace_estimates) %&gt;%
    spread(key = split_goal, value = pace_estimates) %&gt;%
    mutate(goal_pace_time = as.character(seconds_to_period(goal_pace_sec))) %&gt;%
    #&#39; ORGANIZE
    select(goal_pace_time, goal_pace_min, runner_class, split_5k_mark, everything(), goal_pace_sec)
  
  pace_chart_5k_splits &lt;- pace_chart_goal %&gt;%
    mutate_at(.vars = vars(contains(&quot;k&quot;)), seconds_to_period)
  
  
  #&#39; CALCULATE MILE PACES SPLITS 
  pace_chart_wide &lt;- pace_chart_est %&gt;%
    arrange(goal_pace_min, km_pretty) %&gt;%
    group_by(goal_pace_min, runner_class) %&gt;%
    mutate(pace_estimates_lag = lag(pace_estimates)) %&gt;%
    ungroup() %&gt;% 
    mutate(pace_splits = if_else(is.na(pace_estimates_lag),
                                 pace_estimates, pace_estimates - pace_estimates_lag)) %&gt;%
    mutate(split_goal = str_replace_all(split_even, &quot;even&quot;, &quot;goal&quot;)) %&gt;%
    select(split_goal, runner_class, goal_pace_min, goal_pace_sec, pace_splits) %&gt;%
    spread(key = split_goal, value = pace_splits) %&gt;%
    mutate(goal_pace_time = as.character(seconds_to_period(goal_pace_sec))) %&gt;%
    #&#39; ORGANIZE
    select(goal_pace_time, goal_pace_min, runner_class, goal_pace_sec, split_5k_goal, everything(), goal_pace_sec)
  
  pace_chart_5k &lt;- pace_chart_wide  %&gt;%
    mutate_at(.vars = vars(contains(&quot;k&quot;)), seconds_to_period) %&gt;%
    rename_all(~ str_replace_all(., &quot;goal$&quot;, &quot;pace&quot;)) %&gt;%
    mutate(split = &quot;5k&quot;) 
  
  pace_chart_mi &lt;- pace_chart_wide %&gt;%
    mutate_at(.vars = vars(contains(&quot;k&quot;)), ~ seconds_to_period(. / 3.1)) %&gt;%
    rename_all(~ str_replace_all(., &quot;goal$&quot;, &quot;mi_pace&quot;)) %&gt;%
    mutate(split = &quot;Mile&quot;)
  
  pace_chart_combine &lt;- pace_chart_5k_splits %&gt;%
    select(goal_pace_time, contains(&quot;mark&quot;)) %&gt;%
    mutate_at(vars(contains(&quot;mark&quot;)), time_to_character) %&gt;%
    #&#39; JOIN IN 5K PACE INFORMATION
    full_join(
      pace_chart_5k %&gt;%
        select(goal_pace_time, contains(&quot;k_pace&quot;)) %&gt;%
        mutate_at(vars(contains(&quot;pace&quot;)), time_to_character),
    by = &quot;goal_pace_time&quot;
    ) %&gt;%
    #&#39; JOIN IN MILE PACE INFORMATION
    full_join(
      pace_chart_mi %&gt;%
        select(goal_pace_time, contains(&quot;mi_pace&quot;)) %&gt;%
        mutate_at(vars(contains(&quot;mi_pace&quot;)), time_to_character), 
      by = &quot;goal_pace_time&quot;
    ) %&gt;% 
    gather(&quot;split&quot;, &quot;time&quot;, -goal_pace_time) %&gt;%
    mutate(type = case_when(
      str_detect(split, &quot;mark&quot;) ~ &quot;Mark&quot;, 
      str_detect(split, &quot;mi_pace&quot;) ~ &quot;Mile&quot;,
      str_detect(split, &quot;pace&quot;) ~ &quot;5k&quot;,
      TRUE ~ NA_character_
    )) %&gt;%
    mutate(split = str_extract(split, &quot;[0-9]{1,2}k&quot;)) %&gt;% 
    mutate(split = factor(split, levels = c(paste0(seq(5,40,5), &quot;k&quot;))),
           type = factor(type, levels = c(&quot;Mark&quot;, &quot;5k&quot;, &quot;Mile&quot;)))
  
  pace_chart_combine &lt;- pace_chart_combine %&gt;% 
    spread(split, time) %&gt;%
    select(-goal_pace_time)
  
  pace_chart_combine
}

  
  

pace_description &lt;- function(projected_time){
  
  projected_time %&gt;% 
    as_tibble() %&gt;%
    rename(goal_pace_min = value) %&gt;%
    mutate(goal_pace_sec =  goal_pace_min * 60, 
           distance = 42.195,
           goal_pace = 
             paste(trunc(goal_pace_min / 60),
                   ifelse(goal_pace_min %% 60 &lt; 10, 
                          paste0(0, round(goal_pace_min %% 60)), 
                          as.character(round(goal_pace_min %% 60))), sep = &quot;.&quot;)) %&gt;% #&#39; MINUTES
    pace_calculator(distance = &quot;distince&quot;, metric = &quot;km&quot;, seconds = &quot;goal_pace_sec&quot;) %&gt;%
    #&#39; REMOVE UNNESSECARY FIELDS
    select(goal_pace_min, mi_pace, mph, km_pace, kph)
  
  
}</code></pre>
</div>
